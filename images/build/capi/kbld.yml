#@ load("@ytt:data", "data")
---
apiVersion: kbld.k14s.io/v1alpha1
kind: Config
minimumRequiredVersion: 0.28.0
sources:
- imageRepo: cloudfoundry/cf-api-controllers
  path: sources/capi-k8s-release/src/cf-api-controllers
  pack:
    build:
      builder: paketobuildpacks/builder:full
      rawOptions:
      - --env
      - #@ "BP_OCI_REVISION=" + data.values.git_sha
      - --env
      - "BP_OCI_SOURCE=https://github.com/cloudfoundry/capi-k8s-release"
- imageRepo: cloudfoundry/cf-api-backup-metadata-generator
  path: sources/capi-k8s-release/src/backup-metadata-generator
  pack:
    build:
      builder: paketobuildpacks/builder:full
      buildpacks:
      - gcr.io/paketo-buildpacks/go
      - gcr.io/paketo-buildpacks/procfile
      rawOptions:
      - "--default-process"
      - "wait"
      - --env
      - #@ "BP_OCI_REVISION=" + data.values.git_sha
      - --env
      - "BP_OCI_SOURCE=https://github.com/cloudfoundry/capi-k8s-release"
- imageRepo: cloudfoundry/cf-api-package-registry-buddy
  path: sources/capi-k8s-release/src/registry-buddy
  pack:
    build:
      builder: paketobuildpacks/builder:full
      rawOptions:
      - --env
      - #@ "BP_OCI_REVISION=" + data.values.git_sha
      - --env
      - "BP_OCI_SOURCE=https://github.com/cloudfoundry/capi-k8s-release"
destinations:
  - imageRepo: cloudfoundry/cf-api-controllers
    newImage: index.docker.io/cloudfoundry/capi-cf-api-controllers-cf-for-k8s
  - imageRepo: cloudfoundry/cf-api-backup-metadata-generator
    newImage: index.docker.io/cloudfoundry/capi-cf-api-backup-metadata-generator-cf-for-k8s
  - imageRepo: cloudfoundry/cf-api-package-registry-buddy
    newImage: index.docker.io/cloudfoundry/capi-cf-api-package-registry-buddy-cf-for-k8s
